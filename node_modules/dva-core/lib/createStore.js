'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

exports.default = function (_ref) {
  var reducers = _ref.reducers,
      initialState = _ref.initialState,
      plugin = _ref.plugin,
      sagaMiddleware = _ref.sagaMiddleware,
      promiseMiddleware = _ref.promiseMiddleware,
      _ref$createOpts$setup = _ref.createOpts.setupMiddlewares,
      setupMiddlewares = _ref$createOpts$setup === undefined ? _utils.returnSelf : _ref$createOpts$setup;

  // extra enhancers
  var extraEnhancers = plugin.get('extraEnhancers');
  (0, _invariant2.default)((0, _utils.isArray)(extraEnhancers), '[app.start] extraEnhancers should be array, but got ' + (typeof extraEnhancers === 'undefined' ? 'undefined' : (0, _typeof3.default)(extraEnhancers)));

  var extraMiddlewares = plugin.get('onAction');
  var middlewares = setupMiddlewares([sagaMiddleware, promiseMiddleware].concat((0, _toConsumableArray3.default)((0, _flatten2.default)(extraMiddlewares))));

  var devtools = function devtools() {
    return function (noop) {
      return noop;
    };
  };
  if (process.env.NODE_ENV !== 'production' && _window2.default.__REDUX_DEVTOOLS_EXTENSION__) {
    devtools = _window2.default.__REDUX_DEVTOOLS_EXTENSION__;
  }

  var enhancers = [_redux.applyMiddleware.apply(undefined, (0, _toConsumableArray3.default)(middlewares)), devtools(_window2.default.__REDUX_DEVTOOLS_EXTENSION__OPTIONS)].concat((0, _toConsumableArray3.default)(extraEnhancers));

  return (0, _redux.createStore)(reducers, initialState, _redux.compose.apply(undefined, (0, _toConsumableArray3.default)(enhancers)));
};

var _redux = require('redux');

var _flatten = require('flatten');

var _flatten2 = _interopRequireDefault(_flatten);

var _invariant = require('invariant');

var _invariant2 = _interopRequireDefault(_invariant);

var _window = require('global/window');

var _window2 = _interopRequireDefault(_window);

var _utils = require('./utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

module.exports = exports['default'];